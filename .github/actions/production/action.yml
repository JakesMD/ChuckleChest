name: production
description: production

runs:
  using: "composite"

  steps:
    - name: ğŸ—ï¸ Build Production App
      shell: bash
      run: melos build_production -- --dart-define=SUPABASE_PROJECT_URL=${{ env.SUPABASE_PROJECT_URL }} --dart-define=SUPABASE_ANON_KEY=${{ env.SUPABASE_ANON_KEY }}

    - name: â¬†ï¸ Update Website
      shell: bash
      run: melos update_website

    - name: ğŸ”§ Setup GitHub Pages
      uses: actions/configure-pages@v5

    - name: ğŸ“¤ Upload Production App
      uses: actions/upload-pages-artifact@v3
      with:
        path: "./website/public"

    - name: âš¡ï¸ Setup Supabase
      uses: supabase/setup-cli@v1
      with:
        version: latest

    - name: ğŸ—ƒï¸ Push Database Changes
      shell: bash
      run: |
        supabase link --project-ref ${{ env.SUPABASE_PROJECT_ID }}
        supabase db push

    - name: ğŸš€ Deploy Production Website and App
      id: deployment
      uses: actions/deploy-pages@v4
